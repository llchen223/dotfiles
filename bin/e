#!/usr/bin/env bash

last="${@: -1}"
localIgnore='.ptignore'

prefix=''
if test "${last:0:1}" == '.'; then
  if test "${#last}" == 1; then
    regex='^\.?[^.]+$'
  else
    regex="\.(?:$(echo "${last:1}" | tr '.' '|'))$"
  fi
  prefix="--file-search-regexp=$regex"
  set -- "${@:1:$(($#-1))}" # pop argument
fi

if test -f "$localIgnore"; then
  prefix="$prefix $(sed 's/^/--ignore=/' "$localIgnore")"
fi

pt --hidden --global-gitignore --home-ptignore $prefix "$@"
